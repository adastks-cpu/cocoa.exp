import { useState } from "react";
import ConsentForm from "@/components/ConsentForm";
import Questionnaire from "@/components/Questionnaire";
import ThankYou from "@/components/ThankYou";
import { assignQuestionnaire } from "@/lib/questionnaireAssignment";

type Stage = "consent" | "questionnaire" | "complete";

const Index = () => {
  const [stage, setStage] = useState<Stage>("consent");
  const [assignedQuestionnaire, setAssignedQuestionnaire] = useState<1 | 2 | null>(null);

  const handleConsent = () => {
    // Assign questionnaire when user consents (balanced 50/50 split)
    const assigned = assignQuestionnaire();
    setAssignedQuestionnaire(assigned);
    setStage("questionnaire");
  };

  const handleQuestionnaireComplete = (responses: { anchor: number; choice: string; estimate: number }) => {
    console.log("Questionnaire completed:", {
      questionnaireType: assignedQuestionnaire,
      ...responses,
    });
    setStage("complete");
  };

  return (
    <>
      {stage === "consent" && <ConsentForm onConsent={handleConsent} />}
      {stage === "questionnaire" && assignedQuestionnaire && (
        <Questionnaire
          questionnaireType={assignedQuestionnaire}
          onComplete={handleQuestionnaireComplete}
        />
      )}
      {stage === "complete" && <ThankYou />}
    </>
  );
};

export default Index;
